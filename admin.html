<script>
  // Simple password check
  const password = prompt("Enter admin password:");
  if (password !== "Krishna123") {
    alert("Access denied!");
    window.location.href = "/"; // redirect to homepage
  }

  // Then fetch messages only if password is correct
  async function fetchMessages() {
      try {
          const res = await fetch("/admin/messages");
          const data = await res.json();
          const tbody = document.getElementById("messagesBody");
          tbody.innerHTML = "";
          data.forEach(msg => {
              const row = document.createElement("tr");
              row.innerHTML = `
                  <td>${msg.name}</td>
                  <td>${msg.email}</td>
                  <td>${msg.phone || ""}</td>
                  <td>${msg.company || ""}</td>
                  <td>${msg.inquiryType || ""}</td>
                  <td>${msg.message}</td>
                  <td>${new Date(msg.date).toLocaleString()}</td>
              `;
              tbody.appendChild(row);
          });
      } catch (error) {
          console.error("Cannot fetch messages:", error);
      }
  }

  fetchMessages();
</script>



<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Messages</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f0f0f0; }
</style>
</head>
<body>
<h1>All Messages</h1>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Company</th>
      <th>Inquiry Type</th>
      <th>Message</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody id="messagesBody"></tbody>
</table>

<script>
async function fetchMessages() {
    try {
        const res = await fetch("/admin/messages");
        const data = await res.json();
        const tbody = document.getElementById("messagesBody");
        tbody.innerHTML = "";
        data.forEach(msg => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${msg.name}</td>
                <td>${msg.email}</td>
                <td>${msg.phone || ""}</td>
                <td>${msg.company || ""}</td>
                <td>${msg.inquiryType || ""}</td>
                <td>${msg.message}</td>
                <td>${new Date(msg.date).toLocaleString()}</td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error("Cannot fetch messages:", error);
    }
}

fetchMessages();
</script>
</body>
</html>
